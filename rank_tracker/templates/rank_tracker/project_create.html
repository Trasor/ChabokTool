{% extends 'layout/layout.html' %}
{% load static %}

{% block title %}Ø³Ø§Ø®Øª Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯ - Ø±Ø¯ÛŒØ§Ø¨ÛŒ Ø±ØªØ¨Ù‡{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h3 mb-0 text-gray-800">Ø³Ø§Ø®Øª Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯</h1>
                <a href="{% url 'rank_tracker:project_list' %}" class="btn btn-secondary">
                    <i class="ri-arrow-right-line"></i> Ø¨Ø§Ø²Ú¯Ø´Øª
                </a>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡</h5>
                </div>
                <div class="card-body">
                    <form method="post" id="projectForm">
                        {% csrf_token %}

                        <!-- Ù†Ø§Ù… Ù¾Ø±ÙˆÚ˜Ù‡ -->
                        <div class="mb-3">
                            <label for="{{ form.project_name.id_for_label }}" class="form-label">
                                {{ form.project_name.label }}
                            </label>
                            {{ form.project_name }}
                            {% if form.project_name.errors %}
                                <div class="text-danger">
                                    {% for error in form.project_name.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Ø¯Ø§Ù…Ù†Ù‡ Ù‡Ø¯Ù -->
                        <div class="mb-3">
                            <label for="{{ form.target_domain.id_for_label }}" class="form-label">
                                {{ form.target_domain.label }}
                            </label>
                            {{ form.target_domain }}
                            <small class="form-text text-muted">
                                {{ form.target_domain.help_text }}
                            </small>
                            {% if form.target_domain.errors %}
                                <div class="text-danger">
                                    {% for error in form.target_domain.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Ø¸Ø±ÙÛŒØª Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ -->
                        <div class="mb-3">
                            <label for="{{ form.keyword_capacity.id_for_label }}" class="form-label">
                                {{ form.keyword_capacity.label }}
                            </label>
                            <input type="range"
                                   class="form-range"
                                   id="capacityRange"
                                   min="100"
                                   max="1000"
                                   step="100"
                                   value="100"
                                   oninput="updateCapacity(this.value)">

                            <div class="d-flex justify-content-between mt-2">
                                <div>
                                    <h5>Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡: <span id="selectedCapacity" class="text-primary">100</span> Ú©Ù„Ù…Ù‡</h5>
                                </div>
                                <div>
                                    <h5 class="text-danger">Ù‡Ø²ÛŒÙ†Ù‡: <span id="calculatedCost">500</span> Ú©Ø±Ø¯ÛŒØª</h5>
                                </div>
                            </div>

                            <input type="hidden" name="keyword_capacity" id="keyword_capacity" value="100">

                            <small class="form-text text-muted">
                                {{ form.keyword_capacity.help_text }}
                            </small>
                            {% if form.keyword_capacity.errors %}
                                <div class="text-danger">
                                    {% for error in form.keyword_capacity.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <div class="mt-4">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="ri-save-line"></i> Ø§ÛŒØ¬Ø§Ø¯ Ù¾Ø±ÙˆÚ˜Ù‡
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">ğŸ’° Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§</h5>
                </div>
                <div class="card-body">
                    <h3 class="text-center">{{ balance|default:0 }} Ú©Ø±Ø¯ÛŒØª</h3>
                    {% if balance < 500 %}
                        <div class="alert alert-warning mt-3">
                            <strong>ØªÙˆØ¬Ù‡:</strong> Ù…ÙˆØ¬ÙˆØ¯ÛŒ Ø´Ù…Ø§ Ú©Ø§ÙÛŒ Ù†ÛŒØ³Øª! Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Ù¾Ø±ÙˆÚ˜Ù‡ Ø­Ø¯Ø§Ù‚Ù„ 500 Ú©Ø±Ø¯ÛŒØª Ù†ÛŒØ§Ø² Ø§Ø³Øª.
                        </div>
                        <a href="{% url 'transactions_list' %}" class="btn btn-primary w-100">
                            Ø®Ø±ÛŒØ¯ Ú©Ø±Ø¯ÛŒØª
                        </a>
                    {% endif %}
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="mb-0">ğŸ“‹ Ù‚ÛŒÙ…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ</h5>
                </div>
                <div class="card-body">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Ø¸Ø±ÙÛŒØª</th>
                                <th>Ù‡Ø²ÛŒÙ†Ù‡</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>100 Ú©Ù„Ù…Ù‡</td>
                                <td>500 Ú©Ø±Ø¯ÛŒØª</td>
                            </tr>
                            <tr>
                                <td>200 Ú©Ù„Ù…Ù‡</td>
                                <td>1,000 Ú©Ø±Ø¯ÛŒØª</td>
                            </tr>
                            <tr>
                                <td>300 Ú©Ù„Ù…Ù‡</td>
                                <td>1,500 Ú©Ø±Ø¯ÛŒØª</td>
                            </tr>
                            <tr>
                                <td>500 Ú©Ù„Ù…Ù‡</td>
                                <td>2,500 Ú©Ø±Ø¯ÛŒØª</td>
                            </tr>
                            <tr>
                                <td>1000 Ú©Ù„Ù…Ù‡</td>
                                <td>5,000 Ú©Ø±Ø¯ÛŒØª</td>
                            </tr>
                        </tbody>
                    </table>
                    <div class="alert alert-info">
                        <small>
                            ğŸ’¡ Ù‡Ø²ÛŒÙ†Ù‡ ÙÙ‚Ø· Ù‡Ù†Ú¯Ø§Ù… Ø³Ø§Ø®Øª Ù¾Ø±ÙˆÚ˜Ù‡ Ú©Ø³Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯.<br>
                            âœ… Ø¢Ù¾Ø¯ÛŒØª Ø±ØªØ¨Ù‡â€ŒÙ‡Ø§ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø§Ø³Øª (Ù…Ø­Ø¯ÙˆØ¯ÛŒØª 4 Ø¨Ø§Ø±/Ù…Ø§Ù‡)
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function updateCapacity(value) {
    // Ø¢Ù¾Ø¯ÛŒØª Ù…Ù‚Ø¯Ø§Ø± Ù†Ù…Ø§ÛŒØ´ÛŒ
    document.getElementById('selectedCapacity').textContent = value;

    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù‡Ø²ÛŒÙ†Ù‡
    let cost = (parseInt(value) / 100) * 500;
    document.getElementById('calculatedCost').textContent = cost.toLocaleString();

    // Ø¢Ù¾Ø¯ÛŒØª input hidden
    document.getElementById('keyword_capacity').value = value;
}
</script>
{% endblock %}
